<!DOCTYPE html>
<html>
  <body>
    <div id="main">
        <button class="btn btn-outline-primary" id="make_node" type="button" value="add_node">Add Node</button>
    </div>
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <script src="node_modules/dagre/dist/dagre.min.js"></script>
    <script src="node_modules/crypto-js/crypto-js.js"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.1.1/jquery.min.js"></script>

    <script type="text/javascript">
      // Create a new directed graph
      var g = new dagre.graphlib.Graph();

      // Set an object for the graph label
      g.setGraph({});
      g.setDefaultEdgeLabel(function() { return {}; });

      var previous_head_hash = "";
      $('#make_node').click( function(){
        let text = "hoge";
        let str = CryptoJS.SHA256(text);
        let hashbase64 = str.toString(CryptoJS.enc.Base64);
        let current_time = Date.now().toString();
        let encrypted_hash = CryptoJS.AES.encrypt(current_time, hashbase64).toString();
        console.log(encrypted_hash);

        g.setNode(encrypted_hash, { label: text, width: 100, height: 100 });
        if (g.nodes().length > 1) {
          g.setEdge(previous_head_hash, encrypted_hash);
          dagre.layout(g);

          g.nodes().forEach(function(v) {
               console.log("Node " + v + ": " + JSON.stringify(g.node(v)));
          });
          g.edges().forEach(function(e) {
              console.log("Edge " + e.v + " -> " + e.w + ": " + JSON.stringify(g.edge(e)));
          });
        }
        previous_head_hash = encrypted_hash;

      });

    </script>
  </body>
</html>
